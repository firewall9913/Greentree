<html>
<head>

<script 
 src="http://code.jquery.com/jquery-3.1.1.min.js"
 integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
 crossorigin="anonymous">   
</script>

<style>
    table{
        color: #0000CD;
        }
    body{
        background-image: url(https://wallpaperscraft.ru/image/oranzhevyy_fon_sploshnoy_krasochnyy_65839_2560x1600.jpg) !important;
    }
</style>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>
<body>
<form style="display:inline" id="ipasker">
    <input type="text" id="ip" name="ip" placeholder="IP сервера" />
    <input type="text" id="nick" name="nick" placeholder="Ваш никнейм"/>
    <input type="submit" id="goto" value="Присоединиться" />
</form>
<div style="display:none" id="main">
<form id="forma">
    <input type="text" id="message" name="message" placeholder="Ваше сообщение"/>
    <input type="submit" id="send"/>
</form>
</div>

<div id="chat"><table id="myTable"></table></div>
<script>
    $('#ipasker').submit(function(event){
        var ip = $('#ip').val();
        var chat = new WebSocket('ws://'+ip+':9000');
        chat.onmessage = function(data){
            var message = JSON.parse(data.data);
            if (message.type == 'handshake'){
                window.key = message.key;
                $.post( "http://"+ip+":9001", {nick: $('#nick').val(), key:window.key, type:'handshake'}, function(){
                    $('#main').css('display', 'inline');
                    $('#ipasker').css('display', 'none');
                    console.log("registered");  
                });

            } else {
                $('#myTable').append('<tr><h5><td>'+message.nick+':</td></h5><h5><td>'+message.message+'</td></h5></tr>');
            }
        };


        $('#forma').submit(function(event){
            $.post( "http://"+ip+":9001", {key: window.key, message: $('#message').val() } );
            event.preventDefault();
        });
    })
</script>
</body>

